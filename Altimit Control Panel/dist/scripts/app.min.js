'use strict';

var app = angular.module('altimitCPanel', ['ngRoute']);

angular.module('altimitCPanel').config(['$routeProvider',
  function ($routeProvider) {
    $routeProvider.
    when('/', {
      templateUrl: 'views/main.html',
      controller: 'MainCtrl',
      controllerAs: "Ctrl"
    }).
    when('/users', {
      templateUrl: 'views/users.html',
      controller: 'UserCtrl',
      controllerAs: "Ctrl"
    }).
    when('/rooms', {
      templateUrl: 'views/rooms.html',
      controller: 'RoomCtrl',
      controllerAs: "Ctrl"
    }).
      otherwise({
        redirectTo: '/'
    });
  }]);

angular.module('altimitCPanel').controller('UserCtrl', ['$scope', '$http', function ($scope, $http) {
  var me = this;


  me.getUserList = function () {
    //Get user list from server
    $http.get('http://localhost:4567/userList')
      .then(function (response) {
        console.log(response);
        me.userList = response.data;
      }, function () {
        console.log(response);
      });
  };

  me.getUserList();

  me.kickPlayer = function (uuid) {

    console.log(uuid)

    var req = {
      method: 'POST',
      url: 'http://localhost:4567/kickPlayer',
      headers: {
        'Content-Type': undefined
      },
      data: { playerUUID: uuid }
    };

    $http(req)
      .then(function () {
        me.getUserList();
      }), function () {
        console.log("Was not able to kick player");
    };
  }
}]);

angular.module('altimitCPanel').controller('MainCtrl', ['$scope', '$http', '$timeout', function ($scope, $http, $timeout) {
  var me = this;

  //Prevent from calling after server is off line.
  me.makeCalls = true;

  me.callServer = function () {
    //Room count request
    $http.get('http://localhost:4567/roomCount')
      .then(function (response) {
        me.roomCount = response.data;
      }, function () {
        me.roomCount = "N/A";
      });

    //User count request
    $http.get('http://localhost:4567/userCount')
      .then(function (response) {
        me.userCount = response.data;
      }, function () {
        me.userCount = "N/A";
      });

    //Server status
    $http.get('http://localhost:4567/serverStatus')
      .then(function (response) {
        me.serverStatus = "Online";
      }, function () {
        me.serverStatus = "Offline";
        me.makeCalls = false;
      });
  };

  me.callServer();

  $timeout(function() {
    if (me.makeCalls){
      me.callServer();
    }
  }, 15000);

}]);

angular.module('altimitCPanel').controller('RoomCtrl', ['$scope', '$http', function ($scope, $http) {
  var me = this;


  me.getRoomList = function () {
    //Get user list from server
    $http.get('http://localhost:4567/roomList')
      .then(function (response) {
        console.log(response);
        me.roomList = response.data;
      }, function () {
        console.log(response);
      });
  };

  me.getRoomList();

  me.getLength = function (obj) {
    return Object.keys(obj).length;
  };
}]);
